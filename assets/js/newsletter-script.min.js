jQuery(document).ready(function(R){var af=R(window),j=R(document),H=R("body"),D=R("#mailster_iframe"),Z=R("#template-wrap"),ad,s,C=R("#mailster_template .inside"),f=!!R("#mailster_disabled").val(),W=R("#title"),O=R("#mailster_subject"),ab=R("#mailster_preheader"),Y=R("#content"),b=R("#excerpt"),ac=R("#modules"),ae=R("#plain-text-wrap"),N=R("#html-wrap"),u=R("#head"),y=R("#optionbar"),J=[],X=R("#post_ID").val(),ao=0,c=R("#clickmap-stats"),V=R('[name^="mailster_data"]'),G=R("#mailster_nonce").val(),I=false,aj,F,t,K,h,m,M,ag=R("html,body"),g="WebkitAppearance" in document.documentElement.style,l=(/firefox/i).test(navigator.userAgent),k=(/msie|trident/i).test(navigator.userAgent),A,p,al=false,z="ontouchstart" in document.documentElement,o=typeof tinymce=="object",P,E={mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true};function ak(){a("disable");ah();s=(D[0].contentWindow||D[0].contentDocument);if(s.document){s=s.document}aa();var ar=setTimeout(function(){if(!I){D.trigger("load")}},5000);window.Mailster=window.Mailster||{refresh:function(){a("refresh")},save:function(){a("save")},trigger:a,autosave:""};D.on("load",function(){if(I){return false}if(!f){if(!h){h=new ai()}if(!M){M=new aq()}if(!K){K=new ap()}window.Mailster.editbar=M}else{}a("enable");I=true;clearInterval(ar);ad=D.contents().find("body");if(f){window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;ad.on("click","a",function(){window.open(this.href);return false})}else{}a("refresh");if(!Y.val()){a("save")}R("#normal-sortables").on("sortupdate",function(at,au){a("resize")});Z.removeClass("load");J.push(B())});af.on("resize.mailster",function(){a("refresh")});if(/post_status=autoresponder/.test(R("#referredby").val())||/post_status=autoresponder/.test(location.search)){R("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(k){H.addClass("ie")}if(z){H.addClass("touch")}}function aa(){j.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){a("resize")});R("#mailster_submitdiv").on("change","#use_pwd",function(){R("#password-wrap").slideToggle(200).find("input").focus().select();R("#post_password").prop("disabled",!R(this).is(":checked"))});if(!f){j.on("heartbeat-send",function(at,ar){if(ar&&ar.wp_autosave){ar.wp_autosave["content"]=i();ar.wp_autosave["excerpt"]=b.val();ar.mailsterdata=V.serialize()}}).on("click",".restore-backup",function(at,ar){var ar=wp.autosave.local.getSavedPostData();U(ar.content);W.val(ar.post_title);return false}).on("change",".dynamic_embed_options_taxonomy",function(){var ar=R(this),at=ar.val();ar.parent().find(".button").remove();if(at!=-1){if(ar.parent().find("select").length<ar.find("option").length-1){R(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(ar)}}else{ar.parent().html("").append(ar)}return false}).on("click",".add_embed_options_taxonomy",function(){var at=R(this),ar=at.prev().clone();ar.insertBefore(at).val("-1");R("<span> "+mailsterL10n.or+" </span>").insertBefore(ar);at.remove();return false});W.on("change",function(){if(!O.val()){O.val(R(this).val())}});R("form#post").on("submit",function(){if(al){return false}a("save")});R("#mailster_submitdiv").on("click",".sendnow-button",function(){if(!confirm(mailsterL10n.send_now)){return false}});R("#mailster_delivery").on("change","input.timezone",function(){R(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){R(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var ar=R(this).parent().parent().parent();ar.find("span").addClass("disabled")}).on("change","#autoresponder-post_type",function(){var ar=R("#autoresponder-taxonomies");ar.find("select").prop("disabled",true);S("get_post_term_dropdown",{labels:false,names:true,posttype:R(this).val()},function(at){if(at.success){ar.html(at.html)}},function(at,av,au){loader(false)})}).on("click",".category-tabs a",function(){var at=R(this),ar=at.attr("href");R("#mailster_delivery").find(".tabs-panel").hide();R("#mailster_delivery").find(".tabs").removeClass("tabs");at.parent().addClass("tabs");R(ar).show();R("#mailster_is_autoresponder").val((ar=="#autoresponder")?1:"");return false}).on("click",".mailster_sendtest",function(){var at=R(this),ar=R("#delivery-ajax-loading").css("display","inline");at.prop("disabled",true);a("save");S("send_test",{formdata:R("#post").serialize(),to:R("#mailster_testmail").val(),content:Y.val(),head:u.val(),plaintext:b.val()},function(au){ar.hide();at.prop("disabled",false);var av=R('<div class="'+((!au.success)?"error":"updated")+'"><p>'+au.msg+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})},function(au,ax,av){ar.hide();at.prop("disabled",false);var aw=R('<div class="error"><p>'+ax+" "+au.status+": "+av+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})})}).on("change","#mailster_data_active",function(){(R(this).is(":checked"))?R(".active_wrap").addClass("disabled"):R(".active_wrap").removeClass("disabled");R(".deliverydate, .deliverytime").prop("disabled",!R(this).is(":checked"))}).on("change","#mailster_data_autoresponder_active",function(){(R(this).is(":checked"))?R(".autoresponder_active_wrap").addClass("disabled"):R(".autoresponder_active_wrap").removeClass("disabled")}).on("click",".mailster_spamscore",function(){var aw=R(this),ar=R("#delivery-ajax-loading").css("display","inline"),av=R("#spam_score_progress").removeClass("spam-score").slideDown(200),au=av.find(".bar");aw.prop("disabled",true);R(".score").html("");a("save");au.css("width","20%");S("send_test",{spamtest:true,formdata:R("#post").serialize(),to:R("#mailster_testmail").val(),content:Y.val(),head:u.val(),plaintext:b.val()},function(ax){if(ax.success){au.css("width","40%");at(ax.id,1)}else{ar.hide();av.slideUp(200);var ay=R('<div class="error"><p>'+ax.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})}},function(ax,aA,ay){ar.hide();aw.prop("disabled",false);var az=R('<div class="error"><p>'+aA+" "+ax.status+": "+ay+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){az.remove()})});function at(ay,ax){S("check_spam_score",{ID:ay},function(aA){if(aA.score){ar.hide();aw.prop("disabled",false);av.addClass("spam-score");au.css("width",(parseFloat(aA.score)*10)+"%");R(".score").html("<strong>"+x(mailsterL10n.yourscore,aA.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((aA.score/10)*mailsterL10n.yourscores.length)])}else{if(ax<=5&&!aA.abort){var az=(ax*10)+50;au.css("width",(az)+"%");setTimeout(function(){at(ay,++ax)},ax*400)}else{ar.hide();aw.prop("disabled",false);au.css("width","100%");av.slideUp(200);var aB=R('<div class="error"><p>'+aA.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove();au.css("width",0)})}}},function(az,aC,aA){ar.hide();aw.prop("disabled",false);var aB=R('<div class="error"><p>'+aC+" "+az.status+": "+aA+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})})}}).on("blur","input.deliverytime",function(){j.unbind(".mailster_deliverytime")}).on("focus, click","input.deliverytime",function(aw){var ax=R(this),at=R(this)[0],ar=ax.offset().left,ay=0,av=0,au=2;if(aw.clientX-ar>23){ay=1,av=3,au=5}j.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(az){if(az.keyCode==9){return(ay=!ay)?!p(at,3,5):(az.shiftKey)?!p(at,0,2):true}}).on("keyup.mailster_deliverytime",function(az){if(ax.val().length==1){ax.val(ax.val()+":00");p(at,1,1)}if(document.activeElement.selectionStart==2){if(ax.val().substr(0,2)>23){ax.trigger("change");return false}p(at,3,5)}});p(at,av,au)}).on("change","input.deliverytime",function(){var at=R(this),au=at.val(),ar;at.addClass("inactive");if(!/^\d+:\d+$/.test(au)){if(au.length==1){au="0"+au+":00"}else{if(au.length==2){au=au+":00"}else{if(au.length==3){au=au.substr(0,2)+":"+au.substr(2,3)+"0"}else{if(au.length==4){au=au.substr(0,2)+":"+au.substr(2,4)}}}}}ar=au.split(":");if(!/\d\d:\d\d$/.test(au)&&au!=""||ar[0]>23||ar[1]>59){at.val("00:00").focus();p(at[0],0,2)}else{at.val(au)}}).on("change","#mailster_autoresponder_action",function(){R("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+R(this).val())}).on("change","#time_extra",function(){R("#autoresponderfield-mailster_timebased_advanced").slideToggle()}).on("click",".mailster_autoresponder_timebased-end-schedule",function(){(R(this).is(":checked"))?R(".mailster_autoresponder_timebased-end-schedule-field").slideDown():R(".mailster_autoresponder_timebased-end-schedule-field").slideUp()}).on("change",".mailster-action-hooks",function(){var ar=R(this).val();R(".mailster-action-hook").val(ar);if(!ar){R(".mailster-action-hook").focus()}}).on("change",".mailster-action-hook",function(){var ar=R(this).val();if(!R(".mailster-action-hooks option[value='"+ar+"']").length){R(".mailster-action-hooks").append("<option>"+ar+"</option>")}R(".mailster-action-hooks").val(ar)}).on("click",".mailster-total",function(){a("updateCount")}).on("change","#list_extra",function(){if(R(this).is(":checked")){R("#mailster_list_advanced").slideDown()}else{R("#mailster_list_advanced").slideUp()}R("#list-checkboxes").find("input.list").eq(0).trigger("change")}).on("focus","input.datepicker",function(){R(this).removeClass("inactive").trigger("click")}).on("blur","input.datepicker",function(){R(".deliverydate").html(R(this).val());R(this).addClass("inactive")}).on("change","input.datepicker",function(){});R("#mailster_details").on("click",".default-value",function(){var ar=R(this);R("#"+ar.data("for")).val(ar.data("value"))});R("input.color").wpColorPicker({color:true,width:250,mode:"hsl",palettes:R(".colors").data("original-colors"),change:function(ar,at){R(this).val(at.color.toString()).trigger("change")},clear:function(ar,at){}});R(".mailster-preview-iframe").on("load",function(){var au=R(this),at=au.contents(),ar=at.find("body");ar.on("click","a",function(){var av=R(this).attr("href");if(av&&av!="#"){window.open(av)}return false})});if(typeof jQuery.datepicker=="object"){R("#mailster_delivery").find("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var ar=R(this).datepicker("getDate");R(".deliverydate").html(R(this).val())}});R("input.datepicker.nolimit").datepicker("option","minDate",null)}else{R("#mailster_delivery").find("input.datepicker").prop("readonly",false)}R("#mailster_attachments").on("click",".delete-attachment",function(ar){ar.preventDefault();R(this).parent().remove()}).on("click",".add-attachment",function(ar){ar.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var au=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),at=R(".mailster-attachment").eq(0).clone();at.find("img").attr("src",au.icon);at.find(".mailster-attachment-label").html(au.filename);at.find("input").attr("name","mailster_data[attachments][]").val(au.id);at.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});R("#mailster_receivers").on("change","input.list",function(){a("updateCount")}).on("change","#all_lists",function(){R("#list-checkboxes").find("input.list").prop("checked",R(this).is(":checked"));a("updateCount")}).on("change","#ignore_lists",function(){var ar=R(this).is(":checked");R("#list-checkboxes").each(function(){(ar)?R(this).slideUp(200):R(this).slideDown(200)}).find("input.list");a("updateCount")}).on("click",".edit-conditions",function(){tb_show(mailsterL10n.edit_conditions,"#TB_inline?x=1&width=720&height=520&inlineId=receivers-dialog",null);return false}).on("click",".remove-conditions",function(){if(confirm(mailsterL10n.remove_conditions)){R("#receivers-dialog").find(".mailster-conditions-wrap").empty();a("updateCount")}return false}).on("click",".mailster-total",function(){a("updateCount")});R(".close-conditions").on("click",tb_remove);R("#mailster_options").on("click",".wp-color-result",function(){R(this).closest("li.mailster-color").addClass("open")}).on("click","a.default-value",function(){var at=R(this).prev().find("input"),ar=at.data("default");at.wpColorPicker("color",ar);return false}).on("click","ul.colorschema",function(){var at=R("#mailster_options").find("input.color"),ar=R(this).find("li.colorschema-field");a("disable");R.each(ar,function(av){var au=ar.eq(av).data("hex");at.eq(av).wpColorPicker("color",au)});a("enable")}).on("click","a.savecolorschema",function(){var at=R.map(R("#mailster_options").find(".color"),function(au){return R(au).val()});var ar=R("#colorschema-ajax-loading").css("display","inline");S("save_color_schema",{template:R("#mailster_template_name").val(),colors:at},function(au){ar.hide();if(au.success){R(".colorschema").last().after(R(au.html).hide().fadeIn())}},function(au,aw,av){ar.hide()})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var at=R(this).parent().parent();var ar=R("#colorschema-ajax-loading").css({display:"inline"});S("delete_color_schema",{template:R("#mailster_template_name").val(),hash:at.data("hash")},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide()})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var at=R(".colorschema.custom");var ar=R("#colorschema-ajax-loading").css({display:"inline"});S("delete_color_schema_all",{template:R("#mailster_template_name").val()},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide()})}return false}).on("change","#mailster_version",function(){var ar=R(this).val();L(ar)}).on("change","input.color",function(){var at=R(this);var ar=at.data("value");Q(ar,at.val(),at)});R("#mailster_template").on("click","a.getplaintext",function(){var ar=b.val();b.val(mailsterL10n.loading);S("get_plaintext",{html:i()},function(at){b.val(at)},function(at,av,au){b.val(ar)},"HTML")}).on("change","#plaintext",function(){var ar=R(this).is(":checked");b.prop("disabled",ar)[ar?"addClass":"removeClass"]("disabled")})}else{if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}R("#mailster_details").on("click","#show_recipients",function(){var au=R(this),at=R("#recipients-list"),ar=R("#recipients-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_recipients",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_clicks",function(){var au=R(this),at=R("#clicks-list"),ar=R("#clicks-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_clicks",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_environment",function(){var au=R(this),at=R("#environment-list"),ar=R("#environment-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_environment",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_geolocation",function(){var au=R(this),at=R("#geolocation-list"),ar=R("#geolocation-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_geolocation",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100,function(){var az,aA,aC={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ay;var aE;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aE=new google.visualization.GeoChart(document.getElementById("countries_map"));az=aA=google.visualization.arrayToDataTable(av.countrydata);if(location.hash&&(ay=location.hash.match(/region=([A-Z]{2})/))){aw(ay[1])}else{aD()}google.visualization.events.addListener(aE,"regionClick",aw)}});R("a.zoomout").on("click",function(){ax();return false});R("#countries_table").find("tbody").find("tr").on("click",function(){var aF=R(this).data("code");(aF=="unknown"||!aF)?ax():aw(aF);return false});function ax(){var aF={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};az=aA;aD(aF);R("#countries_table").find("tr").removeClass("wp-ui-highlight");R("#mapinfo").hide();location.hash="#region="}function aw(aG){var aF={},aH=aG.region?aG.region:aG,aI;if(aH.match(/-/)){return false}aF.region=aH;(av.unknown_cities[aH])?R("#mapinfo").show().html("+ "+av.unknown_cities[aH]+" unknown locations"):R("#mapinfo").hide();aI=av.geodata[aH]?av.geodata[aH]:[];aF.resolution="provinces";aF.displayMode="markers";aF.dataMode="markers";aF.colors=["#4EBEE9","#2BB3E7"];az=new google.visualization.DataTable();az.addColumn("number","Lat");az.addColumn("number","Long");az.addColumn("string","tooltip");az.addColumn("number","Value");az.addColumn({type:"string",role:"tooltip"});az.addRows(aI);R("#countries_table").find("tr").removeClass("wp-ui-highlight");R("#country-row-"+aH).addClass("wp-ui-highlight");location.hash="#region="+aH;aD(aF)}function aD(aF){aF=R.extend(aC,aF);aE.draw(az,aF);R("a.zoomout").css({visibility:(aC.region!="world"?"visible":"hidden")})}function aB(aG){var aF=aG;R.each(regions,function(aH,aI){if(R.inArray(aG,aI)!=-1){aF=aH}});return aF}})},function(av,ax,aw){ar.hide()});return false}).on("click","#show_errors",function(){var au=R(this),at=R("#error-list"),ar=R("#error-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css("display","inline");S("get_errors",{id:X},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide()});return false}).on("click","#show_countries",function(){R("#countries_wrap").toggle();return false});R("#mailster_details").on("click",".load-more-receivers",function(){var ax=R(this),aw=ax.data("page"),au=ax.data("types"),av=ax.data("orderby"),at=ax.data("order"),ar=ax.next().css({display:"inline"});S("get_recipients_page",{id:X,types:au,page:aw,orderby:av,order:at},function(ay){ar.hide();if(ay.success){ax.parent().parent().replaceWith(ay.html)}},function(ay,aA,az){detailbox.removeClass("loading")});return false}).on("click",".recipients-limit",function(ar){if(ar.altKey){R("input.recipients-limit").prop("checked",false);R(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(av){var ax=R("#recipients-list"),at=R("#recipients-ajax-loading"),au=R("input.recipients-limit:checked").map(function(){return this.value}).get(),aw=R("select.recipients-order").val(),ar=R("a.recipients-order").hasClass("asc")?"ASC":"DESC";at.css({display:"inline"});R("input.recipients-limit").prop("disabled",true);S("get_recipients",{id:X,types:au.join(","),orderby:aw,order:ar},function(ay){at.hide();R("input.recipients-limit").prop("disabled",false);ax.html(ay.html).slideDown(100)},function(ay,aA,az){at.hide()});return false}).on("click","a.recipients-order",function(){R(this).toggleClass("asc");R("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var ar=R(this),au=ar.data("id"),at=R("#receiver-detail-"+au).show();ar.parent().addClass("loading").parent().addClass("expanded");S("get_recipient_detail",{id:au,campaignid:X},function(av){ar.parent().removeClass("loading");if(av.success){at.find("div.receiver-detail-body").html(av.html).slideDown(100)}},function(av,ax,aw){at.removeClass("loading")});return false}).on("click","#stats label",function(){R("#recipients-list").find("input").prop("checked",false).filter("input."+R(this).attr("class")).prop("checked",true).trigger("change")});C.on("mouseenter","a.clickbadge",function(){var ax=R(this),ar=ax.position(),aw=ax.data("p"),av=ax.data("link"),at=ax.data("clicks"),au=ax.data("total");c.find(".piechart").data("easyPieChart").update(aw);c.find(".link").html(av);c.find(".clicks").html(at);c.find(".total").html(au);c.stop().fadeIn(100).css({top:ar.top-85,left:ar.left-(c.width()/2-ax.width()/2)})}).on("mouseleave","a.clickbadge",function(){c.stop().fadeOut(400)});R("#mailster_receivers").on("click",".create-new-list",function(){var ar=R(this).hide();R(".create-new-list-wrap").slideDown();R(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var av=R(this),au=R(".create-list-type"),at="",ar=R(".mailster-total");if(au.val()==-1){return false}if(at=prompt(mailsterL10n.enter_list_name,x(mailsterL10n.create_list,au.find(":selected").text(),R("#title").val()))){ar.addClass("loading");S("create_list",{name:at,listtype:au.val(),id:X},function(aw){ar.removeClass("loading");var ax=R('<div class="'+((!aw.success)?"error":"updated")+'"><p>'+aw.msg+"</p></div>").hide().prependTo(R(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})},function(aw,ay,ax){ar.removeClass("loading")})}return false}).on("change",".create-list-type",function(){var at=R(this),ar=R(".mailster-total");if(at.val()==-1){return false}at.prop("disabled",true);ar.addClass("loading");S("get_create_list_count",{listtype:at.val(),id:X},function(au){at.prop("disabled",false);ar.removeClass("loading").html(au.count)},function(au,aw,av){at.prop("disabled",false);ar.removeClass("loading").html("")})}).on("click",".mailster-total",function(){R(".create-list-type").trigger("change")});R(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#50626f",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(ar){this.$el.find("span").text(Math.round(ar))},onStop:function(ar){this.$el.find("span").text(Math.round(ar))}});j.on("heartbeat-send",function(at,ar){if(ar.wp_autosave){delete ar.wp_autosave}ar.mailster={page:"edit",id:X}}).on("heartbeat-tick",function(ay,aw){if(!aw.mailster[X]){return}var au=aw.mailster[X],at=R("#stats").find(".verybold"),av=R("#stats").find(".piechart"),ar=R(".progress"),ax=(au.sent/au.total*100);R(".hb-sent").html(au.sent_f);R(".hb-deleted").html(au.deleted_f);R(".hb-opens").html(au.opens_f);R(".hb-clicks").html(au.clicks_f);R(".hb-clicks_total").html(au.clicks_total_f);R(".hb-unsubs").html(au.unsubs_f);R(".hb-bounces").html(au.bounces_f);R(".hb-geo_location").html(au.geo_location);R.each(au.environment,function(az){R(".hb-"+az).html((this.percentage*100).toFixed(2)+"%")});if(R("#stats_opens").length){R("#stats_opens").data("easyPieChart").update(Math.round(au.open_rate))}if(R("#stats_clicks").length){R("#stats_clicks").data("easyPieChart").update(Math.round(au.click_rate))}if(R("#stats_unsubscribes").length){R("#stats_unsubscribes").data("easyPieChart").update(Math.round(au.unsub_rate))}if(R("#stats_bounces").length){R("#stats_bounces").data("easyPieChart").update(Math.round(au.bounce_rate))}ar.find(".bar").width(ax+"%");ar.find("span").eq(1).html(au.sent_formatted);ar.find("span").eq(2).html(au.sent_formatted);ar.find("var").html(Math.round(ax)+"%");e(au.clickbadges);if(au.status!=R("#original_post_status").val()&&!R("#mailster_status_changed_info").length){R('<div id="mailster_status_changed_info" class="error inline"><p>'+x(mailsterL10n.statuschanged,'<a href="post.php?post='+X+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});if(typeof wp!="undefined"&&wp.heartbeat){wp.heartbeat.interval("fast")}}}var ai=function(){var av=C.offset();function aG(){y.on("click","a.template",aE).on("click","a.save-template",aC).on("click","a.clear-modules",ay).on("click","a.preview",aA).on("click","a.undo",aF).on("click","a.redo",aB).on("click","a.code",aw).on("click","a.plaintext",ax).on("click","a.dfw",ar).on("click","a.file",at);H.on("click","button.save-template",aD).on("click","button.save-template-cancel",tb_remove);af.on("scroll.optionbar",function(){var aH=af.scrollTop();if(aH<av.top-50||aH>av.top+C.height()-120){if(/fixed-optionbar/.test(H[0].className)){H.removeClass("fixed-optionbar")}y.width("auto")}else{if(!/fixed-optionbar/.test(H[0].className)){H.addClass("fixed-optionbar")}y.width(C.width())}}).on("resize.optionbar",function(){av=C.offset();af.trigger("scroll.optionbar")})}function aC(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);R("#new_template_name").focus().select();return false}function aD(){a("disable");var aK=R("#new_template_name").val();if(!aK){return false}a("save");var aH=R("#new_template-ajax-loading").css("display","inline"),aJ=R("#new_template_modules").is(":checked"),aN=R("#new_template_active_modules").is(":checked"),aL=R("#new_template_saveas_dropdown").val(),aI=!!parseInt(R('input[name="new_template_overwrite"]:checked').val(),10),aM=i();S("create_new_template",{name:aK,modules:aJ,activemodules:aN,overwrite:aI?aL:false,template:R("#mailster_template_name").val(),content:aM,head:u.val()},function(aO){aH.hide();if(aO.success){if(window.wp){window.wp=null}window.location=aO.url}else{alert(aO.msg)}},function(aO,aQ,aP){aH.hide()});return false}function aF(){if(ao){ao--;U(J[ao],100,false);Y.val(J[ao]);y.find("a.redo").removeClass("disabled");if(!ao){R(this).addClass("disabled")}}return false}function aB(){var aH=J.length;if(ao<aH-1){ao++;U(J[ao],100,false);Y.val(J[ao]);y.find("a.undo").removeClass("disabled");if(ao>=aH-1){R(this).addClass("disabled")}}return false}function ay(){if(confirm(mailsterL10n.remove_all_modules)){var aH=D.contents().find("module");var aI=D.contents().find("modules");aI.slideUp(function(){aH.remove();aI.html("").show();a("refresh");a("save")})}return false}function aA(){a("save");var aL=R(this),aJ=i(),aI=O.val(),aH=ab.val(),aK=W.val();if(y.find("a.preview").is(".loading")){return false}y.find("a.preview").addClass("loading");S("set_preview",{id:X,content:aJ,head:u.val(),issue:R("#mailster_autoresponder_issue").val(),subject:aI,preheader:aH},function(aM){y.find("a.preview").removeClass("loading");R(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aM.hash+"&_wpnonce="+aM.nonce);tb_show((aK?x(mailsterL10n.preview_for,'"'+aK+'"'):mailsterL10n.preview),"#TB_inline?hash="+aM.hash+"&_wpnonce="+aM.nonce+"&width="+(Math.min(1200,af.width()-50))+"&height="+(af.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aM,aO,aN){y.find("a.preview").removeClass("loading")})}function az(){y.remove()}function au(){R("#new_template_name").on("focus",function(){j.unbind("keypress.mailster").bind("keypress.mailster",function(aH){if(aH.keyCode==13){aD();return false}})}).select().focus().on("blur",function(){j.unbind("keypress.mailster")})}function aE(aH){var aI=R(this);aI.parent().find("ul").eq(0).slideToggle(100);return false}function aw(){var aI=!D.is(":visible");var aH;if(!aI){aH=n(B());y.find("a.code").addClass("loading");a("disable");S("toggle_codeview",{bodyattributes:aH.parts[2],content:aH.content,head:aH.head},function(aJ){y.find("a.code").addClass("active").removeClass("loading");N.hide();Y.val(aJ.content);y.find("a").not("a.redo, a.undo, a.code").addClass("disabled");P=CodeMirror.fromTextArea(Y.get(0),E)},function(aJ,aL,aK){y.find("a.code").addClass("active").removeClass("loading");a("enable")})}else{aH=n(P.getValue());P.clearHistory();y.find("a.code").addClass("loading");a("disable");S("toggle_codeview",{bodyattributes:aH.parts[2],content:aH.content,head:aH.head},function(aJ){U(aJ.content,100,true,aJ.style);N.show();Y.hide();R(".CodeMirror").remove();y.find("a.code").removeClass("active").removeClass("loading");y.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");a("enable")},function(aJ,aL,aK){y.find("a.code").addClass("active").removeClass("loading");a("enable")})}return false}function ax(){var aH=!D.is(":visible");if(!aH){y.find("a.plaintext").addClass("active");N.hide();b.show();ae.show();y.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled")}else{N.show();ae.hide();y.find("a.plaintext").removeClass("active");y.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");a("refresh")}return false}function ar(aH){if(aH.type=="mouseout"&&!/DIV|H3/.test(aH.target.nodeName)){return}av=C.offset();if(!H.hasClass("focus-on")){H.removeClass("focus-off").addClass("focus-on");R("#wpbody").on("mouseleave.dfw",ar);y.find("a.dfw").addClass("active");if(af.scrollTop()<av.top){d(av.top-80)}}else{H.removeClass("focus-on").addClass("focus-off");R("#wpbody").off("mouseleave",ar);y.find("a.dfw").removeClass("active")}return false}function at(aH){window.onbeforeunload=null}aG();return{hide:function(){az()}}};var aq=function(){var bh=R("#editbar"),aP,a8={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a7=bh.find(".imagepreview"),aK=bh.find(".imagewidth"),aG=bh.find(".imageheight"),av=bh.find(".imagecrop"),bp=bh.find(".factor"),a9=bh.find(".highdpi"),aZ=bh.find(".original"),aE=bh.find(".imagelink"),bs=bh.find(".imageurl"),bv=bh.find(".orgimageurl"),ay=bh.find(".imagealt"),ba=bh.find(".singlelink"),br=bh.find(".buttonlink"),aU=bh.find(".buttonlabel"),aD=bh.find(".buttonalt"),aJ=bh.find(".button-nav"),bu=bh.find("ul.buttons"),bd,aQ,bj,bm,ax,bi,aI,aA,aT,aC,aB,ar=R("#wp-mailster-editor-wrap"),au="",bf=R("#post-search"),aw=R("#image-search"),bb=R('[name="image-search-type"]');function bo(){bh.on("keyup change","input.live",at).on("keyup change","#mailster-editor",at).on("click",".replace-image",a4).on("change",".highdpi",aY).on("click","button.save",aO).on("click",".cancel",az).on("click","a.remove",aW).on("click","a.reload",bl).on("click","a.single-link-content",aS).on("click","a.add_image",a3).on("click","a.add_image_url",aH).on("click",".imagelist li",aM).on("dblclick",".imagelist li",aO).on("change","#post_type_select input",bl).on("click",".postlist li",be).on("click",".load-more-posts",bk).on("click","a.btnsrc",bt).on("click",".imagepreview",aN).on("click","a.nav-tab",aF).on("change","select.check-for-posts",a0).on("change","#dynamic_rss_url",a0).on("keyup change","#post-search",a6).on("keyup change","#image-search",a6).on("change",'[name="image-search-type"]',a6).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aX).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bn);am(D.contents().find("img").eq(0),function(bx,by,bz){var bw=bz>=1.5;bp.val(bz);a9.prop("checked",bw);(bw)?bh.addClass("high-dpi"):bh.removeClass("high-dpi")});aJ.on("click","a",function(){R(this).parent().find("a").removeClass("nav-tab-active");R(this).parent().parent().find("ul.buttons").hide();var bw=R(this).addClass("nav-tab-active").attr("href");R("#tab-"+bw.substr(1)).show();return false});bs.on("paste change",function(bx){var bw=R(this);setTimeout(function(){var bz=a5(bw.val()),by=new Image();if(bz){aR();by.onload=function(){a7.attr("src",bz);aG.val(Math.round(by.width/(by.width/by.height)));bj={width:by.width,height:by.height,asp:by.width/by.height};aR(false)};by.onerror=function(){if(bx.type!="paste"){alert(x(mailsterL10n.invalid_image,'"'+bz+'"'))}};by.src=bz}},1)});aK.on("keyup change",function(){if(!av.is(":checked")){aG.val(Math.round(aK.val()/bj.asp))}aL()});aG.on("keyup change",function(){if(!av.is(":checked")){aK.val(Math.round(aG.val()*bj.asp))}aL()});av.on("change",function(){if(!av.is(":checked")){aG.val(Math.round(aK.val()/bj.asp));av.parent().removeClass("not-cropped")}else{av.parent().addClass("not-cropped")}aL()});R("#dynamic_embed_options_post_type").on("change",function(){var bw=R("#dynamic_embed_options_cats"),bx=R(this).val();bw.find("select").prop("disabled",true);bh.find(".dynamic-rss")[bx=="rss"?"show":"hide"]();aR();S("get_post_term_dropdown",{posttype:bx},function(by){aR(false);if(by.success){bw.html(by.html);if(ax&&ax.terms){var bz=bw.find(".dynamic_embed_options_taxonomy_wrap");R.each(ax.terms,function(bB,bA){if(!bA){return}var bC=bA.split(",");R.each(bC,function(bE,bG){var bD=bz.eq(bB).find("select").eq(bE),bF;if(!bD.length){bF=bz.eq(bB).find("select").last();bD=bF.clone();bD.insertAfter(bF);R("<span> "+mailsterL10n.or+" </span>").insertBefore(bD)}bD.val(bG)})})}}a0()},function(by,bA,bz){aR(false)})});bh.on("keypress.mailster",function(bw){if(bw.keyCode==13&&bw.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(bw){switch(bw.keyCode){case 27:az();return false;break;case 13:if(aQ.type!="multi"&&aQ.type!="codeview"){aO();return false}break}});bh.find(".current-tag").on("click","a",function(){return false});if(bh.draggable){bh.draggable({distance:20,axis:"y"})}if(o&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){a2(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){a2(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){a2(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){a2(this)})}}}function bq(bw){if(bh.draggable){if(bw!==false){bh.draggable("enable")}else{bh.draggable("disable")}}}function aX(){bq(false)}function bn(){bq(true)}function aF(by,bw){var bx;if(typeof by=="string"){bx=aP.find('a[href="'+by+'"]')}else{bx=R(this);by=bx.attr("href")}bx.parent().find("a.nav-tab").removeClass("nav-tab-active");bx.addClass("nav-tab-active");aP.find(".tab").hide();aP.find(by).show();if(by=="#image_button"){bd="image"}if(by=="#text_button"){bd="text"}aI=aP.find(by).find(".postlist").eq(0);return false}function a4(){aR();var bz=bp.val(),bw=aQ.element.width(),by=Math.round(bw/1.6),bx=R("<img>",{src:"https://dummy.mailster.co/"+(bw*bz)+"x"+(by*bz)+".jpg",alt:aQ.content,label:aQ.content,width:bw,height:by,border:0,editable:aQ.content});bx[0].onload=function(){bx.attr({width:bw,height:by}).removeAttr("style");bg()};if(aQ.element.parent().is("a")){aQ.element.unwrap()}if(!aQ.element.parent().is("td")){aQ.element.unwrap()}aQ.element.replaceWith(bx);return false}function aY(){if(R(this).is(":checked")){bp.val(2);bh.addClass("high-dpi")}else{bp.val(1);bh.removeClass("high-dpi")}}function a0(){clearInterval(aT);aR();R("#dynamic_embed_options").find("h4.current-match").html("&hellip;");R("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aT=setTimeout(function(){var bB=bh.find("#dynamic_embed_options_post_type").val(),by=bh.find("#dynamic_embed_options_content").val(),bA=bh.find("#dynamic_embed_options_relative").val(),bz=bh.find(".dynamic_embed_options_taxonomy_wrap"),bx=R("#dynamic_rss_url").val(),bw=[];R.each(bz,function(bE){var bD=R(this).find("select"),bC=[];R.each(bD,function(){var bF=parseInt(R(this).val(),10);if(bF!=-1&&R.inArray(bF,bC)==-1&&!isNaN(bF)){bC.push(bF)}});bC=bC.join(",");if(bC){bw[bE]=bC}});S("check_for_posts",{id:X,post_type:bB,relative:bA,extra:bw,modulename:aQ.name,expect:aQ.elements.expects,rss_url:bx},function(bC){aR(false);if(bC.success){bm=bC.pattern;R("#dynamic_embed_options").find("h4.current-match").html(bC.title);R("#dynamic_embed_options").find("div.current-tag").text(bC.pattern.title+"\n\n"+bC.pattern[by])}},function(bC,bE,bD){aR(false)})},500)}function a5(bA,bw,bx,bB,bz){bw=bw||aK.val();bx=bx||aG.val()||Math.round(bw/1.6);bB=typeof bB=="undefined"?av.prop(":checked"):bB;bz=typeof bz=="undefined"?aZ.prop(":checked"):bz;if(/^\{([a-z0-9-_,;:|~]+)\}$/.test(bA)){var by=bp.val();bA=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+bA.replace("{","").replace("}","")+"&w="+Math.abs(bw)+"&h="+Math.abs(bx)+"&c="+(bB?1:0)+"&o="+(bz?1:0)+"&f="+by}return bA}function a1(bx){if(-1!==bx.indexOf("?action=mailster_image_placeholder&tag=")){var bw=bx.match(/&tag=([a-z0-9-_,;:|~]+)&/);return"{"+bw[1]+"}"}return false}function at(bw){if((bw.keyCode||bw.which)!=27&&aQ){aQ.element.html(R(this).val())}}function aR(bw){if(bw===false){R("#editbar-ajax-loading").hide();bh.find(".buttons").find("button").prop("disabled",false)}else{R("#editbar-ajax-loading").css("display","inline");bh.find(".buttons").find("button").prop("disabled",true)}}function aO(){if(aQ.type=="img"){var bO=aQ.element.is("img");if(bs.val()){bj={id:null,name:"",src:a5(bs.val()),width:bj.width,height:bj.height,asp:bj.width/bj.height}}if(bj){aR();var bK=bp.val()||1,bB=aK.val(),bI=aG.val(),bM=av.is(":checked"),bG=aZ.is(":checked"),bD=bO?"src":"background",bJ;aQ.element.attr({"data-id":bj.id}).data("id",bj.id).addClass("mailster-loading");if(bO){aQ.element.attr({src:bj.src,alt:bj.name});if(!aQ.is_percentage){aQ.element.attr("width",Math.round(bB))}if(aQ.element.attr("height")&&aQ.element.attr("height")!="auto"){aQ.element.attr("height",Math.round(bI))}if(bM){aQ.element.attr({"data-crop":true}).data("crop",true)}if(bG){aQ.element.attr({"data-original":true}).data("original",true)}}if(bj.src){aQ.element.attr(bD,bj.src);if(bJ=aQ.element.attr("style")){aQ.element.attr("style",bJ.replace(/url\("?(.+)"?\)/,"url('"+bj.src+"')"))}}S("create_image",{id:bj.id,original:bG,src:bj.src,width:bB*bK,height:bI*bK,crop:bM},function(bR){aR(false);if(bR.success){a7.attr("src",bR.image.url);bR.image.width=(bR.image.width||bj.width)/bK;bR.image.height=bR.image.width/(bj.asp);bR.image.asp=bj.asp;bj=bR.image;bj.name=ay.val();if(bO){aQ.element.one("load error",function(bV){if("error"==bV.type){alert(x(mailsterL10n.invalid_image,bR.image.url))}aQ.element.removeClass("mailster-loading");a("save")});aQ.element.attr({alt:bj.name});if(!aQ.is_percentage){aQ.element.attr("width",Math.round(aK.val()))}if(aQ.element.attr("height")&&aQ.element.attr("height")!="auto"){aQ.element.attr("height",Math.round(aG.val()))}if(bM){aQ.element.attr({"data-crop":true}).data("crop",true)}if(bG){aQ.element.attr({"data-original":true}).data("original",true)}}else{aQ.element.removeClass("mailster-loading");var bS=aQ.element.html(),bU=bS.match(/<modules/),bT;if(bv.val()){if(bU){if(bU=bS.match(new RegExp("<v:background(.*)</v:background>","s"))){aQ.element.html(an(bS,bU[0],an(bU[0],bv.val(),bj.url)))}}else{aQ.element.html(an(bS,bv.val(),bj.url));aQ.element.find("single, multi").removeAttr("id")}}}aQ.element.removeAttr(bD).attr(bD,bj.url)}else{aQ.element.removeClass("mailster-loading")}ay.val("");bg()},function(bR,bT,bS){aR(false)})}else{aQ.element.attr({alt:ay.val()});bg()}if(aQ.element.parent().is("a")){aQ.element.unwrap()}var bx=aE.val();if(bx){aQ.element.wrap('<a href="'+bx+'"></a>')}return false}else{if(aQ.type=="btn"){var bx=br.val();if(!bx&&!confirm(mailsterL10n.remove_btn)){return false}var bw=aP.find("a.active").find("img").attr("src");if(typeof bw=="undefined"){bd="text";if(!aU.val()){aU.val(mailsterL10n.read_more)}}aQ.element.removeAttr("tmpbutton");if("image"==bd){var bK=bp.val();var bQ=new Image();bQ.onload=function(){if(!aQ.element.find("img").length){var bS=aQ.element.closest(".textbutton");var bR=R('<a href="" editable label="'+aQ.name+'"><img></a>');(bS.length)?bS.replaceWith(bR):aQ.element.replaceWith(bR);aQ.element=bR}aQ.element.find("img").attr({src:bw,width:Math.round((bQ.width||aQ.element.width())/bK),height:Math.round((bQ.height||aQ.element.height())/bK),alt:aD.val()});(bx)?aQ.element.attr("href",bx):aQ.element.remove();bg()};bQ.src=bw}else{var bz=aQ.element.closest(".textbutton"),by=aU.val();if(!bz.length){aQ.element.replaceWith('<table class="textbutton" align="left" role="presentation"><tr><td align="center" width="auto"><a href="'+bx+'" editable label="'+by+'">'+by+"</a></td></tr></table>")}else{if(aQ.element[0]==bz[0]){aQ.element=bz.find("a")}aQ.element.text(by)}if(bx){aQ.element.attr("href",bx)}else{aQ.element.remove();bz.remove()}bg()}return false}else{if(aQ.type=="auto"){var bL=R("#embedoption-bar").find(".nav-tab-active").data("type"),bP=aQ.element.data("position")||0,bE,bC=[],bN,bF;aQ.element.removeAttr("data-tag data-rss").removeData("tag").removeData("data-rss");if("dynamic"==bL){bE=bh.find("#dynamic_embed_options_content").val();bN=bh.find("#dynamic_embed_options_post_type").val();bF=R("#dynamic_rss_url").val();bm.content=bm[bE];aQ.element.attr("data-tag",bm.tag).data("tag",bm.tag);if("rss"==bN){aQ.element.attr("data-rss",bF).data("rss",bF)}}else{bE=R(".embed_options_content:checked").val();aQ.element.removeAttr("data-tag").removeData("tag")}if(bm){if(aQ.elements.single.length){aQ.elements.single.each(function(bR,bU){var bX=R(this),bT=bX.attr("expect")||"title",bW=bm[bT]?bm[bT]:"",bS=[],bV=[];if(!R.isArray(bW)){bS[bP]=bW}else{bS=bW}if(bS[bR]){R(this).html(bS[bR])}})}if(aQ.elements.multi.length){aQ.elements.multi.each(function(bR,bU){var bX=R(this),bT=bX.attr("expect")||bE,bW=bm[bT]?bm[bT]:"",bS=[],bV=[];if(!R.isArray(bW)){bS[bP]=bW}else{bS=bW}if(bS[bR]){R(this).html(bS[bR])}})}if(bm.link){if(aQ.elements.buttons.length){aQ.elements.buttons.eq(bP).attr("href",bm.link)}}else{if(aQ.elements.buttons.parent().length&&aQ.elements.buttons.parent()[0].nodeName=="TD"){aQ.elements.buttons.eq(bP).closest(".textbutton").remove()}else{if(aQ.elements.buttons.length){if(aQ.elements.buttons.eq(bP).last().find("img").length){aQ.elements.buttons.remove()}}}}if(bm.image&&aQ.elements.images.length){if(!R.isArray(bm.image)){bC[bP]=bm.image}else{bC=bm.image}bm.image=bC;aR();aQ.elements.images.each(function(bU,bX){if(!bm.image[bU]){return}var bS=R(this);var bW=bp.val();if("static"==bL){S("create_image",{id:bm.image[bU].id,original:aZ.is(":checked"),width:bS.width()*bW,height:bS.height()*bW,crop:bS.data("crop")},function(b0){if(b0.success){aR(false);if(aZ.is(":checked")){bS.attr({"data-original":true}).data("original",true)}if("img"==bS.prop("tagName").toLowerCase()){bS.attr({"data-id":bm.image[bU].id,src:b0.image.url,width:Math.round(b0.image.width/bW),alt:bm.alt||bm.title[bU]}).data("id",bm.image[bU].id);if(bS.attr("height")&&bS.attr("height")!="auto"){bS.attr("height",Math.round(b0.image.height/bW))}if(bS.parent().is("a")){bS.unwrap()}if(bm.link){bS.wrap("<a>");bS.parent().attr("href",bm.link)}}else{var b1=bS.attr("background");bS.attr({"data-id":bm.image[bU].id,background:b0.image.url}).data("id",bm.image[bU].id).css("background-image","");aQ.element.html(an(aQ.element.html(),b1,b0.image.url));aQ.element.find("single, multi").removeAttr("id");a("save");a("refresh")}}},function(b0,b2,b1){aR(false)});return false}else{if("dynamic"==bL){var bR=bS.width(),bV=bS.data("crop"),bZ=aZ.is(":checked"),bY=bV?bS.height():null;if("img"==bS.prop("tagName").toLowerCase()){bS.removeAttr("data-id").attr({src:a5(bm.image[bU],bR,bY,bV,bZ),width:bR,alt:bm.alt||bm.title[bU]}).removeData("id");if(bS.attr("height")){bS.attr("height",bY||Math.round(bR/1.6))}}else{var bT=bS.attr("background");bS.removeAttr("data-id").attr({background:a5(bm.image[bU],bR)}).removeData("id").css("background-image","");aQ.element.html(an(aQ.element.html(),bT,a5(bm.image[bU],bR,bY,bV,bZ)));aQ.element.find("single, multi").removeAttr("id")}}}})}bP=bP+1>=(aQ.elements.multi.length||aQ.elements.single.length||aQ.elements.images.length)?0:bP+1;aQ.element.data("position",bP);D.contents().find("html").find("img").each(function(){this.onload=function(){a("refresh")}})}}else{if(aQ.type=="multi"){if(o&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){var bH=tinymce.get("mailster-editor").getContent();bH=bH.replace('href="http://{','href="{');aQ.element.html(bH)}}else{if(aQ.type=="single"){if(aQ.conditions){aQ.aa="<if";R.each(R(".conditinal-area"),function(){aQ.aa=""})}if(aQ.element.parent().is("a")){aQ.element.unwrap()}var bx=ba.val();if(bx){aQ.element.wrap('<a href="'+bx+'"></a>')}}else{if(aQ.type=="codeview"){var bA=P.getValue();aQ.element.html(bA);aQ.modulebuttons.prependTo(aQ.element)}}}}}}bg();return false}function aW(){if(aQ.element.parent().is("a")){aQ.element.unwrap()}if("btn"==aQ.type){var bx=aQ.element.closest(".textbutton"),bw=bx.parent();if(!bx.length){bx=aQ.element}if(bw.is("buttons")&&!bw.find(".textbutton").length){bw.remove()}else{bx.remove()}}else{if("img"==aQ.type&&"img"!=aQ.tag){aQ.element.attr("background","")}else{aQ.element.remove()}}bg();return false}function az(){switch(aQ.type){case"img":case"btn":if(aQ.element.is("[tmpbutton]")){aQ.element.remove()}break;default:aQ.element.html(aQ.content);aQ.element.find("single, multi").removeAttr("id")}bg();return false}function bt(){var by=R(this),bw=by.data("link");aP.find(".btnsrc").removeClass("active");by.addClass("active");aD.val(by.attr("title"));if(bw){var bx;br.val(bw);if((bx=(bw+"").indexOf("USERNAME",0))!=-1){br.focus();p(br[0],bx,bx+8)}}return false}function aN(){R(this).toggleClass("zoom")}function aM(by,bx){var bB=bx||R(this),bA=bB.data("id"),bw=bB.data("name"),bz=bB.data("src");if(!bA){return}bj={id:bA,name:bw,src:bz};aR();aP.find("li.selected").removeClass("selected");bB.addClass("selected");if(aQ.element.data("id")==bA){ay.val(aQ.element.attr("alt"))}else{if(aQ.element.attr("alt")!=bw){ay.val(bw)}}bs.val("");a7.attr("src","").on("load",function(){a7.off("load");aQ.width=a7.width();aQ.height=a7.height();aQ.asp=bB.data("asp")||(aQ.width/aQ.height);bj.asp=aQ.asp;aR(false);if(!av.is(":checked")){aG.val(Math.round(aK.val()/aQ.asp))}aL()}).attr("src",bz);return bj}function aL(){var bw=Math.round(0.5*(aQ.height-(aQ.width*(aG.val()/aK.val()))))||0,bx=parseInt(bp.val(),10);a7.css({clip:"rect("+(bw)+"px,"+(aQ.width*bx)+"px,"+(aQ.height*bx-bw)+"px,0px)","margin-top":(-1*bw)+"px"})}function be(){var bA=R(this),bz=bA.data("id"),bw=bA.data("name"),bx=bA.data("link"),by=bA.data("thumbid");if(aQ.type=="btn"){br.val(bx);aD.val(bw);aP.find("li.selected").removeClass("selected");bA.addClass("selected")}else{if(aQ.type=="single"){ba.val(bx);aP.find("li.selected").removeClass("selected");bA.addClass("selected")}else{aR();S("get_post",{id:bz,expect:aQ.elements.expects},function(bB){aR(false);aP.find("li.selected").removeClass("selected");bA.addClass("selected");if(bB.success){bm=bB.pattern;aP.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bm.title+"</span>")}},function(bB,bD,bC){aR(false);aP.find("li.selected").removeClass("selected")})}}return false}function aV(bS){aQ=bS;var by=bS.element,bx=by.closest("module"),bJ=(bA!="img")?bS.offset.top:0,bT=bS.name||"",bA=bS.type,bL=R.trim(by.html()),bM=by.find("if"),bE,bR=aQ.element.data("position")||0,bQ,bH,bC,bF=1;aP=bh.find("div.type."+bA);bh.addClass("current-"+bA);aQ.width=by.width();aQ.height=by.height();aQ.asp=aQ.width/aQ.height;aQ.crop=by.data("crop")?by.data("crop"):false;aQ.tag=by.prop("tagName").toLowerCase();aQ.is_percentage=by.attr("width")&&by.attr("width").indexOf("%")!==-1;aQ.content=bL;ax=aQ.element.data("tag");au="";a("selectModule",bx);if(bM.length){bE={"if":null,elseif:[],"else":null,total:0};bE=[];bh.addClass("has-conditions");bQ=aP.find(".conditinal-area");bH=bh.find(".conditions").eq(0);bH.clone().prependTo(bQ);R.each(bM.find("elseif"),function(){var bV=R(this),bU=bV.html();bE.push({el:bV,html:bU,field:bV.attr("field"),operator:bV.attr("operator"),value:bV.attr("value")});bV.detach();bQ.clone().val(bU).insertAfter(bQ)});R.each(bM.find("else"),function(){var bV=R(this),bU=bV.html();bE.push({el:bV,html:bU});bV.detach();bQ.clone().val(bU).insertAfter(bQ)});bE.unshift({el:bM,html:bM.html(),field:bM.attr("field"),operator:bM.attr("operator"),value:bM.attr("value")})}else{bh.removeClass("has-conditions")}aQ.conditions=bE;if(bA=="img"){aZ.prop("checked",aQ.original);av.prop("checked",aQ.crop).parent()[aQ.crop?"addClass":"removeClass"]("not-cropped");au=R.trim(aw.val());bp.val(1);am(by,function(bU,bV,bW){var bV=bW>=1.5;bp.val(bW);a9.prop("checked",bV);(bV)?bh.addClass("high-dpi"):bh.removeClass("high-dpi");bF=bW})}else{if(bA=="btn"){if(by.find("img").length){R("#button-type-bar").find("a").eq(1).trigger("click");var bB=by.find("img").attr("src");if(aJ.length){var bw=bh.find("img[src='"+bB+"']");if(bw.length){bh.find("ul.buttons").hide();var bP=bw.parent().parent().parent();bh.find('a[href="#'+bP.attr("id").substr(4)+'"]').trigger("click")}else{R.each(bh.find(".button-nav"),function(){R(this).find(".nav-tab").eq(0).trigger("click")})}}aU.val(by.find("img").attr("alt"));am(by.find("img"),function(bU,bV,bW){var bV=bW>=1.5;bp.val(bW);a9.prop("checked",bV);(bV)?bh.addClass("high-dpi"):bh.removeClass("high-dpi");bF=bW})}else{R("#button-type-bar").find("a").eq(0).trigger("click");aU.val(R.trim(by.text())).focus().select();br.val(aQ.element.attr("href"));bh.find("ul.buttons").hide()}}else{if(bA=="auto"){aF("#"+(ax?"dynamic":"static")+"_embed_options",true);au=R.trim(bf.val());if(ax){var bK=ax.substr(1,ax.length-2).split(":"),bz=bK[1].split(";"),bO=bz.shift(),bD=bz.length?bz:null;ax={post_type:bK[0],relative:bO,terms:bD};R("#dynamic_embed_options_post_type").val(ax.post_type).trigger("change");R("#dynamic_embed_options_relative").val(ax.relative).trigger("change")}else{}}else{if(bA=="codeview"){var bI=aP.find("textarea"),bN=by.clone();aQ.modulebuttons=bN.find("modulebuttons");bN.find("modulebuttons").remove();bN.find("single, multi").removeAttr("contenteditable spellcheck id dir style class");var bG=R.trim(bN.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));bI.show().html(bG)}}}}bC=C.offset().top+(aQ.offset.top-(af.height()/2)+(aQ.height/2));bC=Math.max(C.offset().top-200,bC);d(bC,function(){bh.find("h4.editbar-title").html(bT);bh.find("div.type").hide();bh.find("div."+bA).show();if(bx.data("rss")){R("#dynamic_rss_url").val(bx.data("rss"))}var bY=j.scrollTop()+(af.height()/2)-C.offset().top-(bh.height()/2);bh.css({top:bY});aR();if(bA=="single"){if(bE){R.each(bE,function(b3,b4){var b2=aP.find(".conditinal-area").eq(b3);b2.find("select.condition-fields").val(b4.field);b2.find("select.condition-operators").val(b4.operator);b2.find("input.condition-value").val(b4.value);b2.find("input.input").val(b4.html)})}else{var b1=bL.replace(/&amp;/g,"&");ba.val("");if(aQ.element.parent().is("a")){var bV=aQ.element.parent().attr("href");ba.val(bV!="#"?bV:"");aS()}else{if(aQ.element.find("a").length){var bX=aQ.element.find("a");if(b1==bX.text()){var bV=bX.attr("href");b1=bX.text();ba.val(bV!="#"?bV:"")}}}aP.find("input").eq(0).val(R.trim(b1))}}else{if(bA=="img"){var bU=parseInt(by[0].style.maxWidth,10)||by.parent().width()||by.width()||null;var b0=parseInt(by[0].style.maxHeight,10)||by.parent().height()||by.height()||null;var bZ=by.attr("src")||by.attr("background");var bW=a1(bZ)||"";if(by.parent().is("a")){aE.val(by.parent().attr("href").replace("%7B","{").replace("%7D","}"))}else{aE.val("")}ay.val(by.attr("alt"));bs.val(bW);bv.val(bZ);by.data("id",by.attr("data-id"));R(".imageurl-popup").toggle(!!bW);a7.removeAttr("src").attr("src",bZ);bi="attachment";aI=aP.find(".imagelist");bj={id:by.data("id"),src:bZ,width:by.width()*bF,height:by.height()*bF};bj.asp=bj.width/bj.height;bl();aL()}else{if(bA=="btn"){aD.val(by.find("img").attr("alt"));if(by.attr("href")){br.val(by.attr("href").replace("%7B","{").replace("%7D","}"))}bi="link";aI=aP.find(".postlist").eq(0);bl();R.each(aP.find(".buttons img"),function(){var b2=R(this);b2.css("background-color",by.css("background-color"));(b2.attr("src")==bB)?b2.parent().addClass("active"):b2.parent().removeClass("active")})}else{if(bA=="auto"){bi="post";aI=aP.find(".postlist").eq(0);bl();aQ.elements={single:aQ.element.find("single"),multi:aQ.element.find("multi"),buttons:aQ.element.find("a[editable]"),images:aQ.element.find("img[editable], td[background], th[background]"),expects:aQ.element.find("[expect]").map(function(){return R(this).attr("expect")}).toArray()};if((aQ.elements.multi.length||aQ.elements.single.length||aQ.elements.images.length)>1){bh.find(".editbarpostion").html(x(mailsterL10n.for_area,"#"+(bR+1))).show()}else{bh.find(".editbarpostion").hide()}}else{if(bA=="codeview"){if(P){P.clearHistory();P.setValue("");aP.find(".CodeMirror").remove()}}}}}}bh.show(0,function(){if(bA=="single"){bh.find("input").focus().select()}else{if(bA=="img"){aK.val(aQ.width);aG.val(aQ.height);av.prop("checked",aQ.crop)}else{if(bA=="btn"){aK.val(bU);aG.val(b0)}else{if(bA=="multi"){R("#mailster-editor").val(bL);if(o&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bL);tinymce.execCommand("mceFocus",false,"mailster-editor")}}else{if(bA=="codeview"){P=CodeMirror.fromTextArea(bI.get(0),E)}}}}}});aR(false)},100)}function bl(bw,bz){var by=R("#post_type_select").find("input:checked").serialize(),bx={type:bi,posttypes:by,search:au,imagetype:bb.filter(":checked").val(),offset:0};if(bi=="attachment"){bx.id=bj.id}aI.empty();aR();S("get_post_list",bx,function(bA){aR(false);if(bA.success){aA=bA.itemcount;bc(bA.html,true);bz&&bz()}},function(bA,bC,bB){aR(false)})}function bk(){var by=R(this),bz=by.data("offset"),bw=by.data("type");aR();var bx=R("#post_type_select").find("input:checked").serialize();S("get_post_list",{type:bw,posttypes:bx,search:au,imagetype:bb.filter(":checked").val(),offset:bz,itemcount:aA},function(bA){aR(false);if(bA.success){aA=bA.itemcount;by.remove();bc(bA.html,false)}},function(bA,bC,bB){aR(false)});return false}function a6(){var bx=R(this),bw=R.trim("attachment"==bi?aw.val():bf.val());if((!bx.is(":checked")&&au==bw)){return false}au=bw;clearTimeout(aC);aC=setTimeout(function(){bl()},500)}function aS(){R("#single-link").slideDown(200);ba.focus().select();bi="link";aI=aP.find(".postlist").eq(0);bl();return false}function bc(bx,bw,by){if(!by){by=aI}if(bw){by.empty()}if(!by.html()){by.html("<ul></ul>")}by.find("ul").append(bx)}function aH(){R(".imageurl-popup").toggle();if(!bs.val()&&bj.src.indexOf(location.origin)==-1&&bj.src.indexOf("dummy.mailster.co")==-1){bs.val(bj.src)}bs.focus().select();return false}function a3(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var bx=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),bw=R("img").data({id:bx.id,name:bx.name,src:bx.url});bl(null,function(){aM(null,bw)})})}wp.media.frames.mailster_editbar.open()}function a2(bw){clearTimeout(aj);aj=setTimeout(function(){if(!bw){return}var bx=R.trim(bw.save());aQ.element.html(bx)},100)}function bg(){bh.removeClass("current-"+aQ.type).hide();aR(false);R("#single-link").hide();a("refresh");a("save");return false}bo();return{open:function(bw){aV(bw)},close:function(){bg()}}};var ap=function(){var ay=R("#mailster_template"),aK=R("#module-selector"),aA=R("#module-search"),aM=aK.find("li"),aJ=R("a.toggle-modules"),aF=D.contents().find("modules"),aD=D.contents().find("body"),aN=aF.find("module"),aG,av={},aI=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function ax(){var aQ=aK.data("current");at(R(this).data("id"),((aQ&&aQ.is("module"))?aQ:false),true,true);return false}function aB(){var aQ=R(this).parent().parent().parent(),aR=aQ.offset();aQ.insertBefore(aQ.prev("module"));q(aQ.offset().top-aR.top,true);a("refresh");a("save");return false}function aC(){var aQ=R(this).parent().parent().parent(),aR=aQ.offset();aQ.insertAfter(aQ.next("module"));q(aQ.offset().top-aR.top,true);a("refresh");a("save");return false}function au(){var aQ=R(this).parent().parent().parent(),aR=aQ.clone().removeAttr("selected").hide();at(aR,aQ,false,true);return false}function az(){var aQ=R(this).parent().parent().parent();M.open({element:aQ,name:aQ.attr("label"),type:"auto",offset:aQ.offset()});return false}function aE(){var aS=R(this),aR=aS.val(),aQ=aS.parent().parent();if(!aR){aR=aS.attr("placeholder");aS.val(aR)}aQ.attr("label",aR)}function aP(){var aQ=R(this).parent().parent().parent();aQ.fadeTo(100,0,function(){aQ.slideUp(100,function(){aQ.remove();aN=D.contents().find("module");if(!aN.length){aF.html("")}a("refresh");a("save")})});return false}function at(aR,aS,aT,aQ){var aV;if(av[aR]){aV=av[aR].el.clone()}else{if(aR instanceof jQuery){aV=R(aR);aV.find("single, multi, buttons").removeAttr("contenteditable spellcheck id dir style class")}else{return false}}if(!aS&&!aF.length){return false}aN=aF.find("module");if(aS){(aT?aV.hide().insertBefore(aS):aV.hide().insertAfter(aS))}else{if("footer"==aN.last().attr("type")){aV.hide().insertBefore(aN.last())}else{aV.hide().appendTo(aF)}}aN=aF.find("module");aV.slideDown(100,function(){aV.css("display","block");a("refresh");a("save")});if(aQ){var aU=aV.offset().top+C.offset().top-(af.height()/2);d(aU)}}function ar(){var aQ=R(this).parent().parent().parent();M.open({element:aQ,name:aQ.attr("label"),type:"codeview",offset:aQ.offset()});return false}function aO(){Z.toggleClass("show-modules");aI=!aI;window.setUserSetting("mailstershowmodules",aI?1:0);setTimeout(function(){a("resize")},200)}function aH(){aM.hide();aK.find("li:contains('"+R(this).val()+"')").show()}function aL(){C.on("click","a.toggle-modules",aO).on("click","a.addmodule",ax);aA.on("keyup",aH).on("focus",function(){aA.select()});R("#module-search-remove").on("click",function(){aA.val("").trigger("keyup").focus();return false});aw()}function aw(){aN=D.contents().find("module");if(!aN.length){aF.html("")}aG=R(ac.val()).add(aN);if(!aG.length){aK.remove();return}aF=D.contents().find("modules");aF.on("click","button.up",aB).on("click","button.down",aC).on("click","button.auto",az).on("click","button.duplicate",au).on("click","button.remove",aP).on("click","button.codeview",ar).on("change","input.modulelabel",aE);var aT="",aX="",aR=0,aW=0;av=[];R.each(aG,function(a0){var a2=R(this);if(a2.is("module")){var aZ=a2.attr("label")||x(mailsterL10n.module,"#"+(++aW)),a1=mailsterdata.codeview?'<button class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></button>':"",a3=(a2.is("[auto]")?'<button class="mailster-btn auto" title="'+mailsterL10n.auto+'"></button>':"");R("<modulebuttons><span>"+a3+'<button class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></button><button class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></button><button class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></button>'+a1+'<button class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></button></span><input class="modulelabel" type="text" value="'+aZ+'" placeholder="'+aZ+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></modulebuttons>').prependTo(a2);if(!a2.parent().length){av.push({name:aZ,el:a2})}}});var aS,aY,aV=R("<dropzone></dropzone>"),aQ=aV.clone(),aU=aV.add(aQ);if(!R._data(aK[0],"events")){aK.on("dragstart.mailster","li",function(aZ){window.mailster_is_modulde_dragging=true;aZ.originalEvent.dataTransfer.setData("Text",this.id);aD.addClass("drag-active");aY=R(aZ.target).data("id");aF.on("dragenter.mailster",function(a0){var a1=R(a0.target).closest("module");if(!a1.length||aS&&aS[0]===a1[0]){return}aS=a1;aQ.appendTo(aS);aV.prependTo(aS);setTimeout(function(){aQ.addClass("visible");aV.addClass("visible");aN.removeClass("drag-up drag-down");a1.prevAll("module").addClass("drag-up");a1.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(a0){a0.preventDefault()}).on("drop.mailster",function(a0){at(aY,aN.length?(aS&&aS[0]===aF?false:aS):false,aV[0]===a0.target,false,true);aN=D.contents().find("module");a0.preventDefault()});aU.on("dragenter.mailster",function(a0){R(this).addClass("drag-over")}).on("dragleave.mailster",function(a0){R(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aZ){aS=null;aD.removeClass("drag-active");aU.removeClass("visible drag-over").remove();aN.removeClass("drag-up drag-down");aF.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aU.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}}aL();return{refresh:function(){aw()}}};function d(au,at,ar){au=Math.round(au);if(isNaN(ar)){ar=200}if(!k&&(ag.scrollTop()==au||document.scrollingElement.scrollTop==au)){at&&at();return}ag.stop().animate({scrollTop:au},ar,at&&function(){at()})}function q(at,ar){at=Math.round(at);if(ar){window.scrollBy(0,at)}else{window.scrollTo(0,at)}}R(window).on("Mailster:refresh",function(){clearTimeout(F);F=setTimeout(function(){a("resize");if(!f){w()}else{e()}},10)}).on("Mailster:resize",function(){var at=0,ar=0;if(!I){return false}setTimeout(function(){if(!D[0].contentWindow.document.body){return}var au=D.contents().height()||D[0].contentWindow.document.body.offsetHeight||D.contents().find("html")[0].innerHeight||D.contents().find("html").height();au=Math.max(300,au+(ar||0));R("#editor-height").val(au);D.attr("height",au)},at?at:500)}).on("Mailster:save",function(){if(!f&&I){var au=B();var at=J.length,ar=J[at-1];if(ar!=au){Y.val(au);ab.prop("readonly",!au.match("{preheader}"));J=J.splice(0,ao+1);J.push(au);if(at>=mailsterL10n.undosteps){J.shift()}ao=J.length-1;if(ao){y.find("a.undo").removeClass("disabled")}y.find("a.redo").addClass("disabled");if(wp&&wp.autosave){wp.autosave.local.save()}}}}).on("Mailster:disable",function(){al=true;R(".button").prop("disabled",true);R("input:visible").prop("disabled",true)}).on("Mailster:enable",function(){R(".button").prop("disabled",false);R("input:visible, input.wp-color-picker").prop("disabled",false);al=false}).on("Mailster:selectModule",function(at){if(!at.detail){return}var ar=at.detail[0]}).on("Mailster:updateCount",function(){clearTimeout(t);t=setTimeout(function(){var aB=[],aA=[],aw=R("#list-checkboxes").find("input, select"),ax=R("#list-checkboxes").find("input.list"),at=R("#list_extra"),av={},az=R(".mailster-total"),ay=R("#mailster_conditions_render"),ar=R(".mailster-conditions-wrap > .mailster-condition-group"),au=0;R.each(ax,function(){var aC=R(this).val();if(R(this).is(":checked")){aB.push(aC)}});av.id=X;av.lists=aB;av.ignore_lists=R("#ignore_lists").is(":checked");R.each(ar,function(){var aC=R(this).find(".mailster-condition");R.each(aC,function(){var aG=R(this),aE,aF=aG.find(".condition-field").val(),aD=aG.find(".mailster-conditions-operator-field.active").find(".condition-operator").val();if(!aD||!aF){return}aE=aG.find(".mailster-conditions-value-field.active").find(".condition-value").map(function(){return R(this).val()}).toArray();if(aE.length==1){aE=aE[0]}if(!aA[au]){aA[au]=[]}aA[au].push({field:aF,operator:aD,value:aE})});au++});av.operator=R("select.mailster-list-operator").val();av.conditions=aA;az.addClass("loading");a("disable");S("get_totals",av,function(aC){a("enable");az.removeClass("loading").html(aC.totalformatted);ay.html(aC.conditions)},function(aC,aE,aD){a("enable");az.removeClass("loading").html("?")})},10)}).on("Mailster:xxx",function(){});function a(){var ar=arguments[0];var at=arguments[1]||null;var au;if(k){au=document.createEvent("CustomEvent");au.initCustomEvent("Mailster:"+ar,false,false,{detail:at})}else{au=new CustomEvent("Mailster:"+ar,{detail:at})}window.dispatchEvent(au);D[0].contentWindow.window.dispatchEvent(au)}function w(){C.find(".content.mailster-btn").remove();var ar=D.contents().find("html"),at=null;if(!ar){return}setTimeout(function(){if(!R._data(ar[0],"events")){ar.off(".mailster").on("click.mailster","img[editable]",function(aw){aw.stopPropagation();var az=R(this),aA=az.offset(),ay=aA.top+61,ax=aA.left,au=az.attr("label"),av="img";M.open({offset:aA,type:av,name:au,element:az})}).on("click.mailster","module td[background],module th[background]",function(au){au.stopPropagation();at=true}).on("click.mailster","td[background], th[background]",function(aw){aw.stopPropagation();if(!at&&aw.target!=this){return}at=null;var az=R(this),aA=az.offset(),ay=aA.top+61,ax=aA.left,au=az.attr("label"),av="img";M.open({offset:aA,type:av,name:au,element:az})}).on("click.mailster","a[editable]",function(aw){aw.stopPropagation();aw.preventDefault();var az=R(this),aA=az.offset(),ay=aA.top+40,ax=aA.left,au=az.attr("label"),av="btn";M.open({offset:aA,type:av,name:au,element:az})})}if(!mailsterdata.inline){ar.on("click.mailster","multi, single",function(aw){aw.stopPropagation();var az=R(this),aA=az.offset(),ay=aA.top+40,ax=aA.left,au=az.attr("label"),av=az.prop("tagName").toLowerCase();M.open({offset:aA,type:av,name:au,element:az})})}},500)}function e(ar){C.find(".clickbadge").remove();var ar=ar||R("#mailster_click_stats").data("stats"),at=parseInt(ar.total,10);if(!at){return}R.each(ar.clicks,function(av,au){R.each(au,function(ay,aC){var aB=D.contents().find('a[href="'+av.replace("&amp;","&")+'"]').eq(ay);if(aB.length){aB.css({display:"inline-block"});var ax=aB.offset(),aA=ax.top,aw=ax.left+5,aE=(aC.clicks/at)*100,aD=(aE<1?"&lsaquo;1":Math.round(aE))+"%",az=R('<a class="clickbadge '+(aE<40?"clickbadge-outside":"")+'" data-p="'+aE+'" data-link="'+av+'" data-clicks="'+aC.clicks+'" data-total="'+aC.total+'"><span style="width:'+(Math.max(0,aE-2))+'%">'+(aE<40?"&nbsp;":aD)+"</span>"+(aE<40?" "+aD:"")+"</a>").css({top:aA,left:aw}).appendTo(C)}})})}function Q(ax,au,av){if(!ax){ax=au}if(!au){return false}ax=ax.toLowerCase();au=au.toLowerCase();if(ax==au){return false}var at=i(),aw=new RegExp(ax,"gi"),ar=ac.val();if(av){av.data("value",au)}R("#mailster-color-"+ax.substr(1)).attr("id","mailster-color-"+au.substr(1));if(aw.test(ar)){ac.val(ar.replace(aw,au))}if(aw.test(at)){U(at.replace(aw,au),30)}}function an(au,ar,at){if(ar===at){return au}do{au=au.replace(ar,at)}while(ar&&au.indexOf(ar)!==-1);return au}function L(at){var au=i(),av=/\/img\/version(\d+)\//g,aw="/img/"+at+"/";html=au.replace(av,aw);var ar=ac.val();ac.val(ar.replace(av,aw));U(html);return}function B(){var ar=D[0].contentWindow.document.body,ax,av,aw,at,au="";if(typeof ar=="null"||!ar){return""}ax=R("<div>"+ar.innerHTML+"</div>");ax.find(".mce-tinymce, .mce-widget, .mce-toolbar-grp, .mce-container, .screen-reader-text, .ui-helper-hidden-accessible, .wplink-autocomplete, modulebuttons, mailster, #mailster-editorimage-upload-button, button").remove();ax.find("#droplr-chrome-extension-is-installed").remove();ax.find("single, multi, module, modules, buttons").removeAttr("contenteditable spellcheck id dir style class selected");av=R.trim(ax.html().replace(/\u200c/g,"&zwnj;").replace(/\u200d/g,"&zwj;"));aw=ar.attributes||[];at=aw.length;if(at){while(at--){au=" "+aw[at].name+'="'+R.trim(aw[at].value)+'"'+au}}au=R.trim(au.replace(/(webkit |wp\-editor|mceContentBody|position: relative;|cursor: auto;|modal-open| spellcheck="(true|false)")/g,"").replace(/(class="(\s*)"|style="(\s*)")/g,""));return u.val()+"\n<body"+(au?" "+au:"")+">\n"+av+"\n</body>\n</html>"}function i(){return Y.val()||B()}function n(ar){var at=ar.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m);return{parts:at?at:["","","","<multi>"+ar+"</multi>"],content:at?at[3]:"<multi>"+ar+"</multi>",head:at?R.trim(at[1]):"",bodyattributes:at?R("<div"+(at[2]||"")+"></div>")[0].attributes:""}}function U(ax,av,aw,ar){var at=n(ax);var az=at.bodyattributes.length,aA=(g||l)?D[0].contentWindow.document:s,au=R(aA).find("head").find("link"),ay=aA.getElementsByTagName("head")[0];u.val(at.head);if(!ar){ar=""}ay.innerHTML=at.head.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3"+ar);R(ay).append(au);aA.body.innerHTML=at.content;if(az){while(az--){aA.body.setAttribute(at.bodyattributes[az].name,at.bodyattributes[az].value)}}if(av!==false){clearTimeout(aj);aj=setTimeout(function(){K&&K.refresh&&K.refresh();a("refresh")},av||100)}else{a("refresh")}if(typeof aw=="undefined"||aw===true){a("save")}}function T(){return W.val()+Y.val()+b.val()+O.val()+ab.val()}function S(av,au,aw,at,ar){if(R.isFunction(au)){if(R.isFunction(aw)){at=aw}aw=au;au={}}ar=ar?ar:"JSON";R.ajax({type:"POST",url:ajaxurl,data:R.extend({action:"mailster_"+av,_wpnonce:G},au),success:function(ay,az,ax){aw&&aw.call(this,ay,az,ax)},error:function(az,aC,aB){var ax=R.trim(az.responseText);if(aC=="error"&&!aB){return}if(console){console.error(ax)}if("JSON"==ar){var ay=ax.match(/{(.*)}$/);if(ay&&aw){try{ay=R.parseJSON(ay[0]);aw.call(this,ay)}catch(aA){if(console){console.error(aA)}}return}}at&&at.call(this,az,aC,aB);alert(aC+" "+az.status+": "+aB+"\n\n"+mailsterL10n.check_console)},dataType:ar})}function v(ar){return R.trim(ar).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ah(){var aG,aC,ay,at,av,az=new Date(),ar=R(".time"),au=R(".deliverytime").eq(0),aB=R("#mailster_data_active"),aF=parseInt(ar.data("timestamp"),10)*1000,aE=false,aw=aF-az.getTime()+(az.getTimezoneOffset()*60000);var ax=(aE)?1000:20000;function aD(){aG=new Date();az=aG.getTime();aG.setTime(az+aw);ay=aG.getHours();at=aG.getMinutes();if(!f&&aC&&at!=aC[1]&&!aB.is(":checked")){au.val(aA(ay)+":"+aA(at))}aC=[];aC.push(aG.getHours());aC.push(aG.getMinutes());if(aE){aC.push(aG.getSeconds())}av=aC.length;for(var aH=0;aH<av;aH++){aC[aH]=aA(aC[aH])}ar.html(aC.join('<span class="blink">:</span>'));setTimeout(function(){aD()},ax)}function aA(aH){if(aH<10){aH="0"+aH}return aH}aD()}function x(){var ar=Array.prototype.slice.call(arguments),aw=ar.shift(),av=ar.length,au;for(var at=0;at<av;at++){au=new RegExp("%("+(at+1)+"\\$)?(s|d|f)");aw=aw.replace(au,ar[at])}return aw}function am(at,av){at=at.eq(0);if(at.is("img")&&at.attr("src")){var au=new Image(),ar;au.onload=function(){ar=((au.width/at.width()).toFixed(1)||1);if(av){av.call(this,au.width,au.height,isFinite(ar)?parseFloat(ar):1)}};au.src=at.attr("src")}}function r(au,at,ar,av){return(av===false?"":"#")+((1<<24)+(au<<16)+(at<<8)+ar).toString(16).slice(1)}if(document.selection&&document.selection.createRange){p=function(at,av,au){at.focus();at.select();var ar=document.selection.createRange();ar.collapse(true);ar.moveEnd("character",au);ar.moveStart("character",av);ar.select();return true}}else{p=function(ar,au,at){ar.selectionStart=au;ar.selectionEnd=at;return true}}if(window.getSelection){A=function(at){var av="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var au=document.activeElement.value;av=au.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ar=window.getSelection();av=ar.toString()}return av}}else{A=function(at){var au="";if(document.selection.createRange){var ar=document.selection.createRange();au=ar.text}return au}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px",marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"})};ak()});