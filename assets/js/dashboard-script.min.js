jQuery(document).ready(function(j){var m=j("#mailster_nonce").val(),q=j(document.body).hasClass("mobile"),u=j(document.body).hasClass("index-php"),a=j(".postbox .handlediv"),f=j(".mailster-mb-subscribers"),l=j("#mailster-subscriber-range"),b=j("#subscriber-chart-wrap"),e=j("#subscriber-chart"),p,s,h={responsive:false,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(z,y){return n(mailsterdashboardL10n.subscribers,x(z.yLabel))}}},scales:{xAxes:[{ticks:{maxTicksLimit:20},_type:"time",_time:{format:"MM/DD/YYYY HH:mm",round:"day",tooltipFormat:"ll HH:mm"}}],yAxes:[{ticks:{callback:function(y){return d(y,true)}}}]}};if(e.length){s=e[0].getContext("2d")}l.on("change",function(){t()}).trigger("change");j("a.external").on("click",function(){if(this.href){window.open(this.href)}return false});if(!u){j(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:(q?200:0),distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:function(z,y){return y.clone().find(":input").attr("name",function(B,A){return"sort_"+parseInt(Math.random()*100000,10).toString()+"_"+A}).end()},opacity:0.65,update:function(z,y){r()}});j(".postbox .handlediv").each(function(){var y=j(this);y.attr("aria-expanded",!y.parent(".postbox").hasClass("closed"))}).on("click",function(){var y=j(this);y.parent(".postbox").toggleClass("closed");y.attr("aria-expanded",!y.parent(".postbox").hasClass("closed"))})}j(document).on("verified.mailster",function(A,z,B,y){j(".mailster-purchasecode").html(z);j(".mailster-username").html(B);j(".mailster-email").html(y);j("#mailster-mb-mailster").addClass("verified");j("#welcome-panel").delay(2500).fadeTo(400,0,function(){j("#welcome-panel").slideUp(400)})}).on("click",".toggle-indicator",w).on("click",".hide-postbox-tog",function(){j("#"+j(this).val())[j(this).is(":checked")?"show":"hide"]().removeClass("closed");w()}).on("click",".locked",function(){j(".purchasecode").focus().select()}).on("click",".check-for-update",function(){var y=j(this);y.html(mailsterdashboardL10n.checking);c("check_for_update",function(z){y.html(mailsterdashboardL10n.check_again);if(z.success){y.closest(".postbox")[z.update?"addClass":"removeClass"]("has-update");j(".update-version").html(z.version);j(".update-last-check").html(z.last_update)}});return false}).one("click",".load-language",function(){var y=j(this);y.html(mailsterdashboardL10n.downloading);c("load_language",function(z){if(z.success){y.html(mailsterdashboardL10n.reload_page)}});return false}).on("click",".reset-license",function(){if(!confirm(mailsterdashboardL10n.reset_license)){return false}});var k=(function(A){if(!A){return}var E,D=j(".mailster-mb-"+A),F=D.find(".mailster-mb-select"),z=D.find(".mailster-mb-label"),C=D.find(".mailster-mb-link"),y=C.attr("href");if(!F.length){return}F.on("change",function(){B(j(this).val())}).trigger("change");j(document).on("heartbeat-tick",function(H,G){if(E){B(E,true)}});D.find(".piechart").easyPieChart({animate:1000,rotate:180,barColor:"#2BB3E7",trackColor:"#50626f",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(G){this.$el.find("span").text(Math.round(G))},onStop:function(G){this.$el.find("span").text(Math.round(G))}});function B(G,H){if(!H){D.addClass("mailster-loading")}c("get_dashboard_data",{type:A,id:G},function(I){var J=I.data;C.html(J.name).removeAttr("class").addClass("mailster-mb-link").attr("href",y.replace("%d",J.ID));if(J.status){C.addClass("status-"+J.status)}D.find(".stats-total").html(J.sent_formatted);D.find(".stats-open").data("easyPieChart").update(J.openrate*100);D.find(".stats-clicks").data("easyPieChart").update(J.clickrate*100);D.find(".stats-unsubscribes").data("easyPieChart").update(J.unsubscriberate*100);D.find(".stats-bounces").data("easyPieChart").update(J.bouncerate*100);E=J.ID;D.removeClass("mailster-loading")})}});var o=new k("campaigns");var i=new k("lists");function t(z,B,y,A){f.addClass("mailster-loading");c("get_dashboard_chart",{range:l.val()},function(C){g();f.removeClass("mailster-loading");if(!p){p=new Chart(s,{type:"line",data:C.chart,options:h})}})}function g(){p=null;if(e){e.remove()}e=j("<canvas>").prependTo(b);s=e[0].getContext("2d");e.attr({width:b.width(),height:b.height()})}function v(){r();w()}function r(){var y={};j.each(j(".postbox-container"),function(){var A=j(this).data("id");j.each(j(this).find(".postbox"),function(){if(!y[A]){y[A]=[]}y[A].push(this.id)});if(y[A]){y[A]=y[A].join(",")}});var z={action:"meta-box-order",_ajax_nonce:j("#meta-box-order-nonce").val(),page:"newsletter_page_mailster_dashboard",order:y};j.post(ajaxurl,z)}function w(){var A=j(".postbox:hidden").map(function(){return this.id}).toArray(),y=j(".postbox.closed").map(function(){return this.id}).toArray();var z={action:"closed-postboxes",closedpostboxesnonce:j("#closedpostboxesnonce").val(),closed:y.length?y.join(","):"",hidden:A.length?A.join(","):"",page:"newsletter_page_mailster_dashboard"};j.post(ajaxurl,z)}function n(){var y=Array.prototype.slice.call(arguments),C=y.shift(),B=y.length,A;for(var z=0;z<B;z++){A=new RegExp("%("+(z+1)+"\\$)?(s|d|f)");C=C.replace(A,y[z])}return C}function d(z,y){if(z>=1000000){return(z/1000).toFixed(1)+"M"}else{if(z>=1000&&!y){return(z/1000).toFixed(1)+"K"}}return !(z%1)?x(z):""}function x(C,A,F,E){C=(C+"").replace(/[^0-9+\-Ee.]/g,"");var z=!isFinite(+C)?0:+C;var y=!isFinite(+A)?0:Math.abs(A);var H=(typeof E==="undefined")?",":E;var B=(typeof F==="undefined")?".":F;var G="";var D=function(K,J){var I=Math.pow(10,J);return""+(Math.round(K*I)/I).toFixed(J)};G=(y?D(z,y):""+Math.round(z)).split(".");if(G[0].length>3){G[0]=G[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,H)}if((G[1]||"").length<y){G[1]=G[1]||"";G[1]+=new Array(y-G[1].length+1).join("0")}return G.join(B)}function c(B,A,C,z,y){if(j.isFunction(A)){if(j.isFunction(C)){z=C}C=A;A={}}j.ajax({type:"POST",url:ajaxurl,data:j.extend({action:"mailster_"+B,_wpnonce:m},A),success:function(E,F,D){C&&C.call(this,E,F,D)},error:function(D,F,E){if(F=="error"&&!E){return}if(console){console.error(j.trim(D.responseText))}z&&z.call(this,D,F,E)},dataType:y?y:"JSON"})}});