jQuery(document).ready(function(f){var a=f(".mainnav"),j=f("#deliverynav"),l=f(".tab"),k=f("#tab-delivery").find(".subtab"),g=f("#mailster_nonce").val(),b=f("#reserved-tags").data("tags");f("a.external").on("click",function(){if(this.href){window.open(this.href)}return false});f("form#mailster-settings-form").on("submit.lock",function(){return false});if(f("#settingsloaded").length){f(".submit-form").prop("disabled",false);f("form#mailster-settings-form").off("submit.lock")}else{if(console){console.log("error loading settings page")}}j.on("click","a.nav-tab",function(){j.find("a").removeClass("nav-tab-active");k.hide();var n=f(this).addClass("nav-tab-active").attr("href");f("#deliverymethod").val(n.substr(1));f("#subtab-"+n.substr(1)).show();f("input.mailster_sendtest").val(mailsterL10n.save_to_test).prop("disabled",true);return false});a.on("click","a",function(){a.find("li").removeClass("active");l.hide();var n=f(this).parent().addClass("active").find("a").attr("href");f("#tab-"+n.substr(1)).show();location.hash=n;f("form#mailster-settings-form").attr("action","options.php"+n);if("#authentication"==n){e();d()}return false});f(".click-to-select").on("click",function(o){if(document.selection){var n=document.body.createTextRange();n.moveToElementText(this);n.select()}else{if(window.getSelection){var n=document.createRange();n.selectNode(this);window.getSelection().addRange(n)}}});f("#mailster-settings-form").on("click",'a[href^="#"]',function(){a.find('a[href="'+f(this).attr("href")+'"]').trigger("click")});(location.hash&&a.find('a[href="'+location.hash+'"]').length)?a.find('a[href="'+location.hash+'"]').trigger("click"):a.find("a").eq(0).trigger("click");f(".system_mail").on("change",function(){f('[name="mailster_options[system_mail_template]"]').prop("disabled",f(this).val()==0);f('[name="mailster_options[respect_content_type]"]').prop("disabled",f(this).val()==0)});f("#load_location_db").on("click",function(){var o=f(this),n=f(".geo-ajax-loading").css({visibility:"visible"});f("button").prop("disabled",true);h("load_geo_data",function(p){f("button").prop("disabled",false);n.css({visibility:"hidden"});o.prop("disabled",false).html(p.buttontext);if(p.update){f("#location_last_update").html(p.update)}var q=f('<div class="'+((!p.success)?"error":"updated")+'"><p>'+p.msg+"</p></div>").hide().prependTo(o.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){q.remove()})},function(p,s,q){f("button").prop("disabled",false);n.css({visibility:"hidden"});o.prop("disabled",false);var r=f('<div class="error"><p>'+s+" "+p.status+": "+q+"</p></div>").hide().prependTo(o.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){r.remove()})});return false});f(".webversion-bar-checkbox").on("change",function(){(f(this).is(":checked"))?f("#webversion-bar-options").slideDown(200):f("#webversion-bar-options").slideUp(200)});f("#social-services").on("change",".social-service-dropdown",function(){var p=f(this),o=p.find(":selected"),n=o.data("url");p.next(".social-service-url-field").html('<label><span class="description">'+n.replace("%s",'<input type="text" name="mailster_options[services]['+p.val()+']" value="" class="regular-text">')+"</span></label>").find("input").focus()}).on("click",".social-service-remove",function(){f(this).parent().remove();return false});f(".social-service-add").on("click",function(){f("#social-services").find("li").eq(0).clone().appendTo("#social-services").find("select").val(0).parent().find(".social-service-url-field").empty()});f(".has-archive-check").on("change",function(){(f(this).is(":checked"))?f(".archive-slug").slideDown(200):f(".archive-slug").slideUp(200)});f(".edit-slug").on("click",function(){f(this).parent().parent().find("span").hide().filter(".edit-slug-area").show().find("input").focus().select()});f(".users-register").on("change",function(){(f(this).is(":checked"))?f("#"+f(this).data("section")).slideDown(200):f("#"+f(this).data("section")).slideUp(200)});f("#mailster_spf").on("change",function(){(f(this).is(":checked"))?f(".spf-info").slideDown(200):f(".spf-info").slideUp(200)});f("#mailster_dkim").on("change",function(){(f(this).is(":checked"))?f(".dkim-info").slideDown(200):f(".dkim-info").slideUp(200)});f(".dkim-enter-keys").on("click",function(){f(".dkim-keys").slideDown();return false});f("#bounce_active").on("change",function(){(f(this).is(":checked"))?f("#bounce-options").slideDown(200):f("#bounce-options").slideUp(200)});f("#mailster_generate_dkim_keys").on("click",function(){return(f("#dkim_keys_active").length&&confirm(mailsterL10n.create_new_keys));return false});f("input.smtp.secure").on("change",function(){f("#mailster_smtp_port").val(f(this).data("port"))});f("#capabilities-table").on("mouseenter","label",function(){f("#current-cap").stop().html(f(this).attr("title")).css("opacity",1).show()}).on("mouseleave","tbody",function(){f("#current-cap").fadeOut()}).on("change","input.selectall",function(){var n=f(this);f("input.cap-check-"+n.val()).prop("checked",n.prop("checked"))});f(".mailster_sendtest").on("click",function(){var q=f(this),p=q.closest(".mailster-testmail"),o=p.find(".test-ajax-loading").css({visibility:"visible"}),r=p.find("input.mailster-testmail-email").val(),n=f("form#mailster-settings-form").serialize();q.prop("disabled",true);h("send_test",{test:true,formdata:n,basic:true,to:r},function(s){if(s.log&&console){s.success?console.log(s.log):console.error(s.log)}o.css({visibility:"hidden"});q.prop("disabled",false);var t=f('<div class="'+((!s.success)?"error":"updated")+'"><p>'+s.msg+"</p></div>").hide().prependTo(q.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){t.remove()})},function(s,v,t){o.css({visibility:"hidden"});q.prop("disabled",false);var u=f('<div class="error"><p>'+v+" "+s.status+": "+t+"</p></div>").hide().prependTo(q.parent()).slideDown(200).delay(200).fadeIn().delay(4000).fadeTo(200,0).delay(200).slideUp(200,function(){u.remove()})})});f(".mailster_bouncetest").on("click",function(){var q=f(this),o=f(".bounce-ajax-loading").css({visibility:"visible"}),p=f(".bouncetest_status").empty().show(),n=f("form#mailster-settings-form").serialize();q.prop("disabled",true);h("bounce_test",{formdata:n},function(r){m(r.identifier,1,n,function(){q.prop("disabled",false)})},function(r,t,s){o.css({visibility:"hidden"});q.prop("disabled",false);p.html(t+" "+r.status+": "+s)})});f("input.cron_radio").on("change",function(){f(".cron_opts").hide();f("."+f(this).val()).show()});f(".switch-cron-url").on("click",function(){f(".cron_opts").toggleClass("alternative-cron");return false});f("#mailster_add_tag").on("click",function(){var n=f('<div class="tag"><code>{<input type="text" class="tag-key">}</code> &#10152; <input type="text" class="regular-text tag-value"> <a class="tag-remove">&#10005;</a></div>').insertBefore(f(this));n.find(".tag-key").focus()});f(".tags").on("change",".tag-key",function(){var p=f(this),n=p.parent().parent(),o=c(p.val());if(!o){p.parent().parent().remove()}p.val(o);n.find(".tag-value").attr("name","mailster_options[custom_tags]["+o+"]")}).on("click",".tag-remove",function(){f(this).parent().remove();return false});f("#mailster_add_field").on("click",function(){var n=f('<div class="customfield"><a class="customfield-move-up" title="'+mailsterL10n.move_up+'">&#9650;</a><a class="customfield-move-down" title="'+mailsterL10n.move_down+'">&#9660;</a><div><span class="label">'+mailsterL10n.fieldname+':</span><label><input type="text" class="regular-text customfield-name"></label></div><div><span class="label">'+mailsterL10n.tag+':</span><span><code>{</code><input type="text" class="customfield-key code"><code>}</code></span></div><div><span class="label">'+mailsterL10n.type+':</span><select class="customfield-type"><option value="textfield">'+mailsterL10n.textfield+'</option><option value="textarea">'+mailsterL10n.textarea+'</option><option value="dropdown">'+mailsterL10n.dropdown+'</option><option value="radio">'+mailsterL10n.radio+'</option><option value="checkbox">'+mailsterL10n.checkbox+'</option><option value="date">'+mailsterL10n.datefield+'</option></select></div><ul class="customfield-additional customfield-dropdown customfield-radio"><li><ul class="customfield-values"><li><span>&nbsp;</span> <span class="customfield-value-box"><input type="text" class="regular-text customfield-value" value=""> <label><input type="radio" value="" title="'+mailsterL10n.default_selected+'" class="customfield-default" disabled> '+mailsterL10n.default_field+'</label></span></li></ul><span>&nbsp;</span> <a class="customfield-value-add">'+mailsterL10n.add_field+'</a></li></ul><div class="customfield-additional customfield-checkbox"><span>&nbsp;</span><label><input type="checkbox" value="1" title="'+mailsterL10n.default_field+'" class="customfield-default" disabled> '+mailsterL10n.default_checked+'</label></div><a class="customfield-remove">remove field</a><br></div>').appendTo(f(".customfields").eq(0));n.find(".customfield-name").focus()});f("#sync_list_check").on("change",function(){f("#sync_list").slideToggle(200);f(".sync-button").prop("disabled",true)});f("#sync_list").on("click","#add_sync_item",function(){var n=f(".mailster_syncitem");n.eq(0).clone().insertAfter(n.last()).removeAttr("title").find("select").each(function(){f(this).attr("name",f(this).attr("name").replace("[synclist][0]","[synclist]["+n.length+"]"))});f(".sync-button").prop("disabled",true)}).on("click",".remove-sync-item",function(){f(this).parent().remove();f(".sync-button").prop("disabled",true)}).on("change","select",function(){f(".sync-button").prop("disabled",true)}).on("click","#sync_subscribers_wp",function(){if(event.target==this&&!confirm(mailsterL10n.sync_subscriber)){return false}var o=f(this),n=f(".sync-ajax-loading").css({visibility:"visible"});f(".sync-button").prop("disabled",true);h("sync_all_subscriber",{offset:o.data("offset")},function(p){f(".sync-button").prop("disabled",false);if(p.success&&p.count){o.data("offset",p.offset).trigger("click")}else{n.css({visibility:"hidden"});o.data("offset",0)}},function(p,r,q){n.css({visibility:"hidden"});f(".sync-button").prop("disabled",false)});return false}).on("click","#sync_wp_subscribers",function(){if(event.target==this&&!confirm(mailsterL10n.sync_wp_user)){return false}var o=f(this),n=f(".sync-ajax-loading").css({visibility:"visible"});f(".sync-button").prop("disabled",true);h("sync_all_wp_user",{offset:o.data("offset")},function(p){f(".sync-button").prop("disabled",false);if(p.success&&p.count){o.data("offset",p.offset).trigger("click")}else{n.css({visibility:"hidden"});o.data("offset",0)}},function(p,r,q){n.css({visibility:"hidden"});f(".sync-button").prop("disabled",false)});return false});f(".customfields").on("change",".customfield-name",function(){var o=f(this),n=o.parent().parent().parent().find(".customfield-key");if(!n.val()){n.val(o.val()).trigger("change")}}).on("change",".customfield-key",function(){var p=f(this),n=p.parent().parent().parent(),o=c(p.val());if(!o){n.remove()}p.val(o);n.find(".customfield-name").attr("name","mailster_options[custom_field]["+o+"][name]");n.find(".customfield-type").attr("name","mailster_options[custom_field]["+o+"][type]");n.find(".customfield-value").attr("name","mailster_options[custom_field]["+o+"][values][]");n.find(".customfield-default").attr("name","mailster_options[custom_field]["+o+"][default]")}).on("click",".customfield-remove",function(){f(this).parent().remove()}).on("click",".customfield-move-up",function(){var n=f(this).parent();n.insertBefore(n.prev())}).on("click",".customfield-move-down",function(){var n=f(this).parent();n.insertAfter(n.next())}).on("change",".customfield-type",function(){var n=f(this).val();f(this).parent().parent().find(".customfield-additional").slideUp(200).find("input").prop("disabled",true);if(n!="textfield"){f(this).parent().parent().find(".customfield-"+n).stop().slideDown(200).find("input").prop("disabled",false)}}).on("change",".customfield-value",function(){f(this).next().find("input").val(f(this).val())}).on("click","a.customfield-value-remove",function(){f(this).parent().parent().remove()}).on("click","a.customfield-value-add",function(){var n=f(this).parent().find("li").eq(0).clone();n.appendTo(f(this).parent().find("ul")).find("input").val("").focus().select()});f("#mailster_import_data").on("click",function(){if(!confirm(mailsterL10n.import_data)){return false}});f("#mailster_reset_data").on("click",function(){if(!confirm(mailsterL10n.reset_data)){return false}});function m(q,r,o,t){var s=f(this),n=f(".bounce-ajax-loading").css({visibility:"visible"}),p=f(".bouncetest_status");h("bounce_test_check",{identifier:q,passes:r,formdata:o},function(u){p.html(u.msg);if(u.complete){n.css({visibility:"hidden"});t&&t()}else{setTimeout(function(){m(q,++r,o,t)},1000)}},function(u,w,v){n.css({visibility:"hidden"});s.prop("disabled",false);p.html(w+" "+u.status+": "+v)})}function e(){var n=f(".spf-result").css({visibility:"visible"});h("spf_check",function(o){if(o.success){n.html(o.message).addClass(o.found?"verified":"not-verified").removeClass("spinner")}else{}},function(o,q,p){n.html("error")})}function d(){var n=f(".dkim-result").css({visibility:"visible"});h("dkim_check",function(o){if(o.success){n.html(o.message).addClass(o.found?"verified":"not-verified").removeClass("spinner")}else{}},function(o,q,p){n.html("error")})}function c(o){var n=f.trim(o).toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9_-]*/g,"").replace(/^[_]*/,"").replace(/[_]*$/,"");if(f.inArray(n,b)!=-1){alert(i(mailsterL10n.reserved_tag,'"'+n+'"'));n+="-a"}return n}function h(p,o,q,n){if(f.isFunction(o)){if(f.isFunction(q)){n=q}q=o;o={}}f.ajax({type:"POST",url:ajaxurl,data:f.extend({action:"mailster_"+p,_wpnonce:g},o),success:function(s,t,r){q&&q.call(this,s,t,r)},error:function(r,t,s){if(t=="error"&&!s){return}if(console){console.error(f.trim(r.responseText))}n&&n.call(this,r,t,s)},dataType:"JSON"})}function i(){var n=Array.prototype.slice.call(arguments),r=n.shift(),q=n.length,p;for(var o=0;o<q;o++){p=new RegExp("%("+(o+1)+"\\$)?(s|d|f)");r=r.replace(p,n[o])}return r}});